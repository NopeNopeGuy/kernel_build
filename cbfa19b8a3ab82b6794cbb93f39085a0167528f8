{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ce5b7e1c_885d57d3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T19:43:17Z",
      "side": 1,
      "message": "PS2 scales back to just the attribute. But, it\u0027s not working properly. There are two issues:\n\n1. Passing `--lto\u003dthin` while passing `kernel_build.sanitizer \u003d \"kasan\"` does not fail. I\u0027m not sure why...\n\n2. Adding `kernel_build.sanitizer \u003d \"kasan\"` does not seem to properly change the defconfig fragments. Again, I\u0027m not sure why.",
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "155908da_02df4ca0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "Setting default to `None` in the selector fixed both of these issues.",
      "parentUuid": "ce5b7e1c_885d57d3",
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ad7d7ef8_12a120b9",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T20:58:43Z",
      "side": 1,
      "message": "where is this used?",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 36
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51a1146d_d405ffa9",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "In `kernel_build.bzl:796`. Was getting a visibility error without it.",
      "parentUuid": "ad7d7ef8_12a120b9",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 36
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1afe4e49_dc27fe1b",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:11:39Z",
      "side": 1,
      "message": "Ah I see. See my other comment. I think instead of exposing the file directly, kernel_build can continue using `arm64_kasan_sw_tags` so it also checks for whether LTO is set to the correct value.",
      "parentUuid": "51a1146d_d405ffa9",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 36
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "464a62bd_ab80206b",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1afe4e49_dc27fe1b",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 36
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ccd091a2_589a2e86",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 27,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T20:58:43Z",
      "side": 1,
      "message": "Where are these used?",
      "range": {
        "startLine": 26,
        "startChar": 0,
        "endLine": 27,
        "endChar": 22
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b4ea9d8_3ddab28a",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 27,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "Around same place as above.",
      "parentUuid": "ccd091a2_589a2e86",
      "range": {
        "startLine": 26,
        "startChar": 0,
        "endLine": 27,
        "endChar": 22
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0f42cce_89aa45db",
        "filename": "kleaf/impl/defconfig/BUILD.bazel",
        "patchSetId": 2
      },
      "lineNbr": 27,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-17T17:07:21Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "6b4ea9d8_3ddab28a",
      "range": {
        "startLine": 26,
        "startChar": 0,
        "endLine": 27,
        "endChar": 22
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "239604b5_5c1a6b86",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 787,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:10:40Z",
      "side": 1,
      "message": "Should be a simple `\"kasan_any_mode\"`\n\nThis refers to the values in the \"files\" dict below, not actual labels.\n\nSee docs for `files_selector` for details on its API. The values are just IDs that are used in the first/second/thrid selector and in the values for files.",
      "range": {
        "startLine": 787,
        "startChar": 67,
        "endLine": 787,
        "endChar": 117
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b8f0bc67_8f27e65f",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 787,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:13:07Z",
      "side": 1,
      "message": "https://cs.android.com/android/kernel/superproject/+/common-android-mainline:build/kernel/kleaf/impl/file_selector.bzl",
      "parentUuid": "239604b5_5c1a6b86",
      "range": {
        "startLine": 787,
        "startChar": 67,
        "endLine": 787,
        "endChar": 117
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "579d40c6_4da9fdbb",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 787,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b8f0bc67_8f27e65f",
      "range": {
        "startLine": 787,
        "startChar": 67,
        "endLine": 787,
        "endChar": 117
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f62254c9_6f314cf3",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 788,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:10:40Z",
      "side": 1,
      "message": "Should be `\"kasan_sw_tags\"`",
      "range": {
        "startLine": 788,
        "startChar": 66,
        "endLine": 788,
        "endChar": 146
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cf1a7fe2_68650a76",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 788,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f62254c9_6f314cf3",
      "range": {
        "startLine": 788,
        "startChar": 66,
        "endLine": 788,
        "endChar": 146
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80e4fa45_5c20f709",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 789,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:10:40Z",
      "side": 1,
      "message": "`\"kcsan\"`",
      "range": {
        "startLine": 789,
        "startChar": 58,
        "endLine": 789,
        "endChar": 99
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0f2c4b8_239cca98",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 789,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "80e4fa45_5c20f709",
      "range": {
        "startLine": 789,
        "startChar": 58,
        "endLine": 789,
        "endChar": 99
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "42c22d31_07752551",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 790,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T20:58:43Z",
      "side": 1,
      "message": "I think you need \"None\" here to fall back to \"second_selector\", right?",
      "range": {
        "startLine": 790,
        "startChar": 36,
        "endLine": 790,
        "endChar": 45
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9dc56c63_f126c34a",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 790,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "Ah okay, you\u0027re right.",
      "parentUuid": "42c22d31_07752551",
      "range": {
        "startLine": 790,
        "startChar": 36,
        "endLine": 790,
        "endChar": 45
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41f5194a_f1d0bfe5",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:10:40Z",
      "side": 1,
      "message": "This should be `kasan_any_mode`, right?\n\n... so that it also gets the check on whether LTO values are compatible.",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a8ded96_64748565",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:10:40Z",
      "side": 1,
      "message": "kasan_any_mode",
      "range": {
        "startLine": 795,
        "startChar": 84,
        "endLine": 795,
        "endChar": 97
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e169cd81_8999f9bf",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T23:12:16Z",
      "side": 1,
      "message": "I mean `//build/kernel/kleaf/impl/defconfig:kasan_any_mode` instead of `//build/kernel/kleaf/impl/defconfig:kasan_any_mode_defconfig`",
      "parentUuid": "41f5194a_f1d0bfe5",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4de2a848_31b4d82d",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6a8ded96_64748565",
      "range": {
        "startLine": 795,
        "startChar": 84,
        "endLine": 795,
        "endChar": 97
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13e2ce7b_13651107",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-14T00:16:55Z",
      "side": 1,
      "message": "I think the issue with that strategy is that the `kasan_any_mode` filegroup will return nothing if the `--kasan` flag isn\u0027t set, right?\n\n```\nfilegroup(\n    name \u003d \"kasan_any_mode\",\n    srcs \u003d select({\n        \"//build/kernel/kleaf:kasan_any_mode_is_true\": [\"kasan_any_mode_defconfig\"],\n        \"//build/kernel/kleaf:kasan_any_mode_is_false\": [],\n        \"//conditions:default\": [\":fail_kasan_any_mode_lto\"],\n    }),\n    visibility \u003d [\"//visibility:public\"],\n)\n```\n\nWhen I try what you\u0027re suggesting, it seems like the sanitizer isn\u0027t actually applied.",
      "parentUuid": "e169cd81_8999f9bf",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5394cd23_f240f16b",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-17T17:01:04Z",
      "side": 1,
      "message": "@elsk@google.com, any notes on how to handle the above?",
      "parentUuid": "13e2ce7b_13651107",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c83723ee_39a8598c",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-17T17:05:21Z",
      "side": 1,
      "message": "\u003e I think the issue with that strategy is that the kasan_any_mode filegroup will return nothing if the --kasan flag isn\u0027t set, right?\n\nIsn\u0027t that what we want?\n\n- If --kasan (which should really be --kasan_any_mode) is set and --lto\u003d(none or default), then apply kasan_any_mode_defconfig.\n- If --kasan (which should really be --kasan_any_mode) is not set, then don\u0027t return anything.\n- Otherwise (which means --kasan (kasan_any_mode) is set but LTO is incorrect value), fail.",
      "parentUuid": "5394cd23_f240f16b",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72de2e04_d228ea22",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 795,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-17T17:07:21Z",
      "side": 1,
      "message": "Ah I see, the issue may lie in kernel_build.\n\n```\n        first_selector \u003d select({\n            Label(\"//build/kernel/kleaf:kasan_any_mode_is_true\"): \"kasan_any_mode\",\n            Label(\"//build/kernel/kleaf:kasan_sw_tags_is_true\"): \"kasan_sw_tags\",\n            Label(\"//build/kernel/kleaf:kcsan_is_true\"): \"kcsan\",\n            \"//conditions:default\": None,\n        }),\n```\n\nIf --kasan is set and LTO is incorrect value, then `None` is picked. But in fact, we want a fail branch somehow. Let me think about this a bit...",
      "parentUuid": "c83723ee_39a8598c",
      "range": {
        "startLine": 795,
        "startChar": 55,
        "endLine": 795,
        "endChar": 79
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57020488_dbe0697b",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 2055,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T20:58:43Z",
      "side": 1,
      "message": "add `values` and `default` so you don\u0027t need to handle the empty case",
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a3ebf7fd_c8fb87f6",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 2055,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "57020488_dbe0697b",
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d8133ded_b6671ff7",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 2261,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2023-10-13T20:58:43Z",
      "side": 1,
      "message": "You don\u0027t need to handle the empty case here if you set `default\u003d\"default\"`",
      "range": {
        "startLine": 2261,
        "startChar": 7,
        "endLine": 2261,
        "endChar": 26
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec3c0079_93db8d89",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 2
      },
      "lineNbr": 2261,
      "author": {
        "id": 1965070
      },
      "writtenOn": "2023-10-13T22:54:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d8133ded_b6671ff7",
      "range": {
        "startLine": 2261,
        "startChar": 7,
        "endLine": 2261,
        "endChar": 26
      },
      "revId": "cbfa19b8a3ab82b6794cbb93f39085a0167528f8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}