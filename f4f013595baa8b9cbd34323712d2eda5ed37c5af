{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8aadd569_5d84b58c",
        "filename": "kleaf/scmversion.sh",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2021-10-14T14:47:59Z",
      "side": 1,
      "message": "we should not delete this. Running this command takes \u003e1s on cold cache, 650ms on warm cache and 3ms on rerun. Adding more than 500ms to every build unconditionally seems wasteful. Store it somewhere else?",
      "range": {
        "startLine": 45,
        "startChar": 0,
        "endLine": 45,
        "endChar": 17
      },
      "revId": "f4f013595baa8b9cbd34323712d2eda5ed37c5af",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7a115d64_4d5ccc5a",
        "filename": "kleaf/scmversion.sh",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-14T21:50:11Z",
      "side": 1,
      "message": "I need to delete it to prevent regular build.sh builds from reading this file directly (instead of reading from git)\n\n\u003e Store it somewhere else?\n\nSee https://b.corp.google.com/issues/202077908#comment3. I can store it in .generated/scmversion, if you want me to do that.",
      "parentUuid": "8aadd569_5d84b58c",
      "range": {
        "startLine": 45,
        "startChar": 0,
        "endLine": 45,
        "endChar": 17
      },
      "revId": "f4f013595baa8b9cbd34323712d2eda5ed37c5af",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ce55585_6f99426f",
        "filename": "kleaf/scmversion.sh",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2021-10-15T16:58:04Z",
      "side": 1,
      "message": "I would store it in any case, possibly as you suggest in the .generated/ directory. Not storing it gives us a startup penalty of almost a second.",
      "parentUuid": "7a115d64_4d5ccc5a",
      "range": {
        "startLine": 45,
        "startChar": 0,
        "endLine": 45,
        "endChar": 17
      },
      "revId": "f4f013595baa8b9cbd34323712d2eda5ed37c5af",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "443dae35_b1d9a2a3",
        "filename": "kleaf/scmversion.sh",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-19T01:11:40Z",
      "side": 1,
      "message": "Actually, I think about it a bit more, and I think the 1 second is unavoidable with the current design. Even with Patchset 2:\n\nhttps://android-review.googlesource.com/c/kernel/build/+/1852747/2/kleaf/save_scmversion.sh\n\n... where I store it in the .generated directly, I still have to execute it on the git directory and ensure the file is up to date. Otherwise it is incorrect.\n\n---\n\nAn alternative way is to create a rule that executes setlocalversion unconditionally, and without sandbox. Then we can at least parallelize its execution with something else when possible.",
      "parentUuid": "9ce55585_6f99426f",
      "range": {
        "startLine": 45,
        "startChar": 0,
        "endLine": 45,
        "endChar": 17
      },
      "revId": "f4f013595baa8b9cbd34323712d2eda5ed37c5af",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}