{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1af5f653_f90fed7e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 7,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-22T17:02:22Z",
      "side": 1,
      "message": "nowadays we rather use the terminology \"ABI extraction\" as we do much more than just dumping it.",
      "range": {
        "startLine": 7,
        "startChar": 7,
        "endLine": 7,
        "endChar": 22
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33943e1f_a41d54ff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 7,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T03:59:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1af5f653_f90fed7e",
      "range": {
        "startLine": 7,
        "startChar": 7,
        "endLine": 7,
        "endChar": 22
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d28e64d8_5d6b2f69",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 1191,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-22T17:02:22Z",
      "side": 1,
      "message": "directory or dir (unstripped is already in the provider name)",
      "range": {
        "startLine": 1191,
        "startChar": 9,
        "endLine": 1191,
        "endChar": 23
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b9c51581_61847274",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 1191,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T03:59:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d28e64d8_5d6b2f69",
      "range": {
        "startLine": 1191,
        "startChar": 9,
        "endLine": 1191,
        "endChar": 23
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6177da76_1988e49d",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3530,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-22T17:02:22Z",
      "side": 1,
      "message": "while we have a reference to ROOT_DIR and KERNEL_DIR, we do not necessarily need an actual kernel dir. The only condition to be satisfied is that within the directory that we let abidw search for files there is only the vmlinux and the .ko files that we care about; and nothing more or less. So, within a bazel sandbox and vmlinux+.ko files specified as dependencies, that should boil down to `abidw $(cwd)`",
      "range": {
        "startLine": 3530,
        "startChar": 41,
        "endLine": 3530,
        "endChar": 71
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f2fb14bc_9d39b34a",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3530,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T19:31:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6177da76_1988e49d",
      "range": {
        "startLine": 3530,
        "startChar": 41,
        "endLine": 3530,
        "endChar": 71
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd7bc033_59fb9d30",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3565,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-22T17:02:22Z",
      "side": 1,
      "message": "do we really need a full blown kernel env?\n \nall we need is the input files and the tools",
      "range": {
        "startLine": 3565,
        "startChar": 23,
        "endLine": 3565,
        "endChar": 56
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "816357bf_4ea9e802",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3565,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T03:40:19Z",
      "side": 1,
      "message": "I know; this is said in the line in L3561.\n\nWe do need at least kernel_env\u0027s setup for ROOT_DIR and KERNEL_DIR for sanitization. However, with your comment in L3530, it seems that we don\u0027t need those? I don\u0027t think I fully understand what you mean there.\n\nThat being said, I think the current sanitization logic will break because sandboxing changes the value of ROOT_DIR.",
      "parentUuid": "fd7bc033_59fb9d30",
      "range": {
        "startLine": 3565,
        "startChar": 23,
        "endLine": 3565,
        "endChar": 56
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "43a97baa_d9619678",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3565,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-23T15:27:29Z",
      "side": 1,
      "message": "I don\u0027t think we need ROOT_DIR/KERNEL_DIR.\n\nabidw operates on a tree (at least when we call it with the parameters set through `dump_abi`). In that mode it discovers kernel binaries by name/extension: vmlinux + *.ko. So, as long as we make sure we call `dump_abi` on a directory that only contains the correct artifacts (and not more or less) however deeply nested in subdirectories, we should be fine. We can ensure that by declaring the execution dependencies correctly to contain the correct kernel binaries. Does that makes sense? Libabigail had a bug (or feature) with symbolic links, but the version we have in Android here does work with symbolic links. (aosp/1806622)\n\nFor the sanitization, we need to look at the actual XML files that come out of that. Odds are that we can by now skip the sanitization altogether as we are now using the compiler to strip the unneeded parts out. See https://cs.android.com/android/kernel/superproject/+/common-android-mainline:build/kernel/_setup_env.sh;l\u003d121. Perhaps we need to give this a try and see.",
      "parentUuid": "816357bf_4ea9e802",
      "range": {
        "startLine": 3565,
        "startChar": 23,
        "endLine": 3565,
        "endChar": 56
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1636842f_38868092",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3565,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T19:31:31Z",
      "side": 1,
      "message": "Done. I delete all sanitization logic and nothing seems to change (tested on raviole-5.15 branch).",
      "parentUuid": "43a97baa_d9619678",
      "range": {
        "startLine": 3565,
        "startChar": 23,
        "endLine": 3565,
        "endChar": 56
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93e4b392_80df253f",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3565,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-04-01T05:51:06Z",
      "side": 1,
      "message": "In fact, this works with sandbox builds but doesn\u0027t work with `--strategy KernelBuild\u003dlocal --strategy KernelConfig\u003dlocal`. Note the action that runs dump_abi is sandbox. Hence, I think the paths are embedded in vmlinux already.\n\nFiled b/227704305 for this.",
      "parentUuid": "1636842f_38868092",
      "range": {
        "startLine": 3565,
        "startChar": 23,
        "endLine": 3565,
        "endChar": 56
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afcceeda_a302c92f",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3568,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-03-22T17:02:22Z",
      "side": 1,
      "message": "this sounds like too much setup costs.",
      "range": {
        "startLine": 3566,
        "startChar": 0,
        "endLine": 3568,
        "endChar": 41
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9351c3fc_e22137a3",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3568,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T03:40:19Z",
      "side": 1,
      "message": "This is just creating symlinks. Is that still too much? We are creating symlinks in sandboxes anyway.",
      "parentUuid": "afcceeda_a302c92f",
      "range": {
        "startLine": 3566,
        "startChar": 0,
        "endLine": 3568,
        "endChar": 41
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92f3c38a_6ead4e90",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 8
      },
      "lineNbr": 3568,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-23T03:59:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9351c3fc_e22137a3",
      "range": {
        "startLine": 3566,
        "startChar": 0,
        "endLine": 3568,
        "endChar": 41
      },
      "revId": "252643722d39f3e1954bd7315c79bd44ef6bcbf1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}