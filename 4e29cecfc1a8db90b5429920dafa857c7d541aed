{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b46a2be8_88408ab9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T00:28:33Z",
      "side": 1,
      "message": "Looks like kleaf needs to be updated, too. The error I get locally is:\n\nNDK_TRIPLE set, but unable to find prebuilts/ndk.\nDid you forget to checkout prebuilts/ndk?\n\nwhich is a sanity-check I added in this commit. So it looks like kleaf is running _setup_env.sh.\n\nPrinting the value of ROOT_DIR for a given run of\n\n$ tools/bazel run --verbose_failures //common:kernel_dist -- --flat\n\nI see:\n\nROOT_DIR is /android0/kernel-common/out/bazel/output_user_root/31dd3ce66350cac040c9977548931ec2/sandbox/linux-sandbox/7/execroot/__main__\n\nI assume I need to tell kleaf about the newly added prebuilts/ndk/ somehow?",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d6dc066_65f63e1d",
        "filename": "_setup_env.sh",
        "patchSetId": 7
      },
      "lineNbr": 144,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-31T01:24:12Z",
      "side": 1,
      "message": "```\n      echo \"ERROR: NDK_TRIPLE set, but unable to find prebuilts/ndk.\" \u003e\u00262\n      echo \"Did you forget to checkout prebuilts/ndk?\" \u003e\u00262\n      exit 1\n```",
      "range": {
        "startLine": 142,
        "startChar": 0,
        "endLine": 144,
        "endChar": 12
      },
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bdfd4689_8400e71f",
        "filename": "_setup_env.sh",
        "patchSetId": 7
      },
      "lineNbr": 144,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T17:27:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6d6dc066_65f63e1d",
      "range": {
        "startLine": 142,
        "startChar": 0,
        "endLine": 144,
        "endChar": 12
      },
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b22d0abe_87a1932b",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-31T01:25:52Z",
      "side": 1,
      "message": "You probably want to add new deps here so they are depended on for all builds.\n\nOr is the dependency optional for certain builds? In that case, you can add it unconditionally here, then file a bug on me to minimize the dependency.",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbdd7cd9_e99101e5",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-03-31T01:27:15Z",
      "side": 1,
      "message": "Note: you can\u0027t add a \"directory\" (prebuilts/ndk) as a dependency, only files under it. See prebuilts/clang/host/linux-x86/clang-*/BUILD.bazel for an example.",
      "parentUuid": "b22d0abe_87a1932b",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b74c586_6aa5e83d",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T17:27:22Z",
      "side": 1,
      "message": "The dependency will be required for all builds.\n\nRight, so last night I had added the below, but this was still failing.\n\nSo the newly added dependency on the prebuilt NDK does contain a BUILD.bazel file.\nhttps://android.googlesource.com/toolchain/prebuilts/ndk/r23/+/refs/heads/master/toolchains/llvm/prebuilt/linux-x86_64/BUILD.bazel\n\nWhile it declares bin/* and lib64/*, I suspect I also need to update the NDK to declare the headers from that dir...I think...? (since we\u0027re using the NDK as a sysroot, we need the libc headers and libraries from Bionic).\n\nThe build is still failing because of the check I added in _setup_env.sh that ${ROOT_DIR} does not contain prebuilts/ndk/.  So I\u0027m not sure in the bazel sandbox where, how, or even if the prebuiltds/ndk/ gets included or is available.",
      "parentUuid": "fbdd7cd9_e99101e5",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5dbf817f_99c3a1c6",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T17:57:29Z",
      "side": 1,
      "message": "Ah, looks like I need to update `setup` in kleaf/kernel.bzl.",
      "parentUuid": "6b74c586_6aa5e83d",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e69b16b0_b8b34a3c",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T18:10:49Z",
      "side": 1,
      "message": "Yeah, so I think the BUILD.bazel file in the NDK prebuilts will need to be fixed.\n\nIf I copy most of the newly added logic from _setup_env.sh into kleaf/kernel.bzl, the kernel build fails during the .config check because UAPI_HEADER_TEST gets disabled because CC_CAN_LINK fails because bazel is only including bin and lib64 from the NDK, but not sysroot.\n\nLet me send a patch to the NDK.",
      "parentUuid": "5dbf817f_99c3a1c6",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6013574_a916ccb6",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T18:32:13Z",
      "side": 1,
      "message": "aosp/2052029\n\nNow I need to update this to use :sysroot rather than :binaries.\n\nThe configs don\u0027t match still, not sure yet why.",
      "parentUuid": "e69b16b0_b8b34a3c",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c115abc8_a757e9ac",
        "filename": "kleaf/kernel.bzl",
        "patchSetId": 7
      },
      "lineNbr": 787,
      "author": {
        "id": 1114194
      },
      "writtenOn": "2022-03-31T19:31:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a6013574_a916ccb6",
      "revId": "4e29cecfc1a8db90b5429920dafa857c7d541aed",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}