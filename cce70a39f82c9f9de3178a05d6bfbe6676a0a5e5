{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a3dc4b3f_13628d1f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-10-07T16:29:10Z",
      "side": 1,
      "message": "Please address Matthias comments.",
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e4a8f27_88e6517b",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-10-07T12:42:45Z",
      "side": 1,
      "message": "I know it is a hardlink, but why does it need to be copied there anyway? can the tar not use the original file location?",
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e2b53947_8e64f39a",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-10-07T19:38:47Z",
      "side": 1,
      "message": "This would be better IMO:\n\n```\nmkdir -p {intermediates_dir}/module_staging_dir\ntar xf {base_modules_archive} -C {intermediates_dir}/module_staging_dir\nfind {intermediates_dir}/module_staging_dir -name \u0027*.ko\u0027 -exec mv -t {intermediates_dir}/ \\\\+\nrm -rf {intermediates_dir}/module_staging_dir\n```\n\n... though, I think there might be cleverer tar tricks that avoid the find \u0026 mv \u0026 extra extraction.",
      "parentUuid": "6e4a8f27_88e6517b",
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac2b1fa5_82a9a464",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-10-07T19:42:29Z",
      "side": 1,
      "message": "Does extract_symbols script look into subdirectories? If so, there\u0027s no need to extract to some temp directory then move them; just extract to {intermediates_dir} directly.\n\nTricks you can do to extract only certain files (*.ko) from a tar: https://superuser.com/a/1524665 (I am not sure if --wildcards are supported in the prebuilt tar binary)\n\nTricks you can do to flatten the directory if extract_symbols doesn\u0027t support subdirectories: use --transform",
      "parentUuid": "e2b53947_8e64f39a",
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e04a1209_ef0d9ed6",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 73,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-10-07T20:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6e4a8f27_88e6517b",
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f395b7ed_73a17b24",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 76,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2022-10-07T12:42:45Z",
      "side": 1,
      "message": "instead of extracting and copying around (`mv` would be a better option here!), perhaps tell `tar` to extract right to the correct location:\n\n`--transform\u003d\u0027s/.*lib\\///\u0027`  (untested)\n\nor use `--strip-components`. \n\nI am not familiar with the properties of that archive.",
      "range": {
        "startLine": 75,
        "startChar": 1,
        "endLine": 76,
        "endChar": 38
      },
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08ca6f40_b3c650b2",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 76,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-10-07T20:01:08Z",
      "side": 1,
      "message": "For transform/strip-components to work we need to know how many levels we need to jump to reach .ko file and it will differ for every .ko file. `xform` will leave lot of mess in the directory and leftover may accidentally collide with something in future.\n\n```\nramjiyani@ramjiyani-desktop:/tmp/mods$ tar xvzf modules_staging_dir.tar.gz --xform\u003d\u0027s#^.+/##x\u0027\n./\n./lib/\n./lib/modules/\n./lib/modules/5.15.41-maybe-dirty/\n./lib/modules/5.15.41-maybe-dirty/kernel/\n./lib/modules/5.15.41-maybe-dirty/kernel/drivers/\n./lib/modules/5.15.41-maybe-dirty/kernel/drivers/block/\n./lib/modules/5.15.41-maybe-dirty/kernel/drivers/block/zram/\n./lib/modules/5.15.41-maybe-dirty/kernel/drivers/block/zram/zram.ko\n./lib/modules/5.15.41-maybe-dirty/kernel/mm/\n./lib/modules/5.15.41-maybe-dirty/kernel/mm/zsmalloc.ko\n./lib/modules/5.15.41-maybe-dirty/source\n./lib/modules/5.15.41-maybe-dirty/build\n./lib/modules/5.15.41-maybe-dirty/modules.order\n./lib/modules/5.15.41-maybe-dirty/modules.builtin.modinfo\n./lib/modules/5.15.41-maybe-dirty/modules.builtin\nramjiyani@ramjiyani-desktop:/tmp/mods$ ls\n5.15.41-maybe-dirty  drivers  mm               modules.builtin.modinfo     source   zsmalloc.ko\nblock                kernel   modules          modules.order               zram\nbuild                lib      modules.builtin  modules_staging_dir.tar.gz  zram.ko\nramjiyani@ramjiyani-desktop:/tmp/mods$\n```\n\nAnother thing I tried is this:\n\n`tar --directory\u003d{intermediates_dir} --wildcards -xf {gki_modules_archive} \u0027*.ko\u0027`\n\nBut this again extracts only .ko but in the full directory structure starting from /lib/.... ; so still have to do the `find exec mv`.",
      "parentUuid": "f395b7ed_73a17b24",
      "range": {
        "startLine": 75,
        "startChar": 1,
        "endLine": 76,
        "endChar": 38
      },
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd0372db_3cf0ec87",
        "filename": "kleaf/impl/abi/extracted_symbols.bzl",
        "patchSetId": 7
      },
      "lineNbr": 76,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-10-07T20:14:21Z",
      "side": 1,
      "message": "how about --xform \u0026\u0026 --wildcards together?",
      "parentUuid": "08ca6f40_b3c650b2",
      "range": {
        "startLine": 75,
        "startChar": 1,
        "endLine": 76,
        "endChar": 38
      },
      "revId": "cce70a39f82c9f9de3178a05d6bfbe6676a0a5e5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}