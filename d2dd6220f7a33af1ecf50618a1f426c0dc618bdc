{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "452927c4_fb970d89",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-11-07T09:39:49Z",
      "side": 1,
      "message": "The empty regex (in the case vendors *do* format the file correctly) matches everything.\n\n```\n$ echo \u003e/tmp/zz\n$ echo asdf | grep -f /tmp/zz\nasdf\n```\n\nperhaps an additional: sed -i \u0027/^$/d\u0027",
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c57896a9_6f30c707",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-11-07T23:27:17Z",
      "side": 1,
      "message": "Thanks, Giuliano.\n\nI did not see this issue in my testing i.e. if the input file already has an extra empty line at the end.\n\nDebugging further I noticed, grep is using `--word-regexp` i.e. `grep -w -f` so only with whole words will be used as filters.\n\nLine#172:\n`! grep -w -f ${modules_list_filter} ${old_modules_list} \u003e ${dest_dir}/modules.order`",
      "parentUuid": "452927c4_fb970d89",
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17dc2bb7_fa82a185",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-11-07T23:28:50Z",
      "side": 1,
      "message": "```\n$ echo \u003e zz\n$ echo asdf | grep -f zz\nasdf\n$ echo asdf | grep -w -f zz\n$\n```",
      "parentUuid": "c57896a9_6f30c707",
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79137123_7334cf49",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-11-07T09:42:17Z",
      "side": 1,
      "message": "1. I\u0027d move the line correction to be the first thing (just add an empty line unconditionally).\n2. Then strip off space*#.*$\n3. Then delete completely empty lines.\n\nThis will resolve the issue I\u0027ve already mentioned and handle in-line comments.",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c371ecb2_cb10f426",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-11-07T23:27:17Z",
      "side": 1,
      "message": "I don\u0027t know whether you notice it or not; but I am not modifying the original file but a temp file `modules_list_filter` before it being used at Line#172 as filter and getting deleted at Line#173.\n\nIn addition, I don\u0027t see the issue you are referring as empty regex matching to everything, as mentioned in my other comment; probably due to `--word-regexp`.\n\nAlso, something like below doesn\u0027t work either and it strips the last module listed in the file; so I think filter do need an extra empty line at the end.\n\n```\n    # Append a new line at the end of file\n    # If file doesn\u0027t end in newline the last module is skipped from filter\n    echo \"\" \u003e\u003e ${modules_list_filter}\n\n    # Remove end spaces and tabs\n    sed -i \u0027s/[[:blank:]]*$//\u0027 ${modules_list_filter}\n\n    # Remove empty lines\n    sed -i \u0027/^$/d\u0027 ${modules_list_filter}\n```\n\nLet me know, if I misunderstood something here.",
      "parentUuid": "79137123_7334cf49",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9786098_98521839",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-11-08T07:15:01Z",
      "side": 1,
      "message": "This shouldn\u0027t be dropping the last module, perhaps something else is going on. Do you have a mix of CRLF and LF line endings?\n\necho \"\" can be just echo\n\n\u0027s/[[:blank:]]*$//\u0027 should be \u0027s/[[:blank:]]*#[[:blank:]]*$//\u0027 or perhaps -r \u0027s/[[:blank:]]*(#[[:blank:]]*)?$//\u0027\n\nAnother thing to note is that `comm` or `join` may do exactly what you need. However, the inputs need to be \"clean\" (I\u0027m not sure to what degree) and sorted.",
      "parentUuid": "c371ecb2_cb10f426",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4660457_11f2e173",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-11-08T07:49:32Z",
      "side": 1,
      "message": "Thanks Guiliano.\n\nHow do I check whether I have mix of CRLF and LF? (I don\u0027t think I do but don\u0027t know as well on how to check it.)\n\nIssue can be reproduced on `android14-5.15` with this file which is default module list:\n\nhttps://cs.android.com/android/kernel/superproject/+/common-android-mainline:common/android/gki_system_dlkm_modules\n\nAnd checking the content of `out/android14-5.15/dist/system_dlkm.modules.load` file at the end of the `kernel_aarch64` build.\n\nIs it worth going this complex when `sed -i \u0027$a\\\\\u0027 ${modules_list_filter}` addresses the issue without any downside in all cases?\n\nI\u0027ll give your other suggestions a try tomorrow; if you think we should go with it.",
      "parentUuid": "a9786098_98521839",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60485fa1_cccc87c0",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-11-17T14:07:18Z",
      "side": 1,
      "message": "Sorry, missed this response.\n\nThere are many ways to check for CRLF.\n\nod -a\nemacs (M-x find-file-literally)\ndos2unix and cmp\ngrep \u0027^M\u0027 (quote ctrl-V ctrl-M quote at the console)\n\nhttps://cs.android.com/android/kernel/superproject/+/common-android-mainline:common/android/gki_system_dlkm_modules already has a spurious blank line at the end!\n\nI think you are better off talking to a Unix person in the same TZ if you are having odd issues.\n\nLastly, the simplest way to append a newline is: echo \u003e\u003e \"$file\".\n\nIf you need to keep doing this, use echo instead of sed.",
      "parentUuid": "b4660457_11f2e173",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2abc36d_b9551b4e",
        "filename": "build_utils.sh",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1889091
      },
      "writtenOn": "2022-11-30T22:56:07Z",
      "side": 1,
      "message": "Thanks.\n\nBy the time, you get to it; I end up pushing the empty line with module conversion which I had to quicken my test in conversion process. ðŸ˜Š\n\nI did not have mix of LF and CRLF.\n\nI ended up adding an empty line in temp filter file using the echo; as a last resort.",
      "parentUuid": "60485fa1_cccc87c0",
      "range": {
        "startLine": 166,
        "startChar": 0,
        "endLine": 168,
        "endChar": 40
      },
      "revId": "d2dd6220f7a33af1ecf50618a1f426c0dc618bdc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}