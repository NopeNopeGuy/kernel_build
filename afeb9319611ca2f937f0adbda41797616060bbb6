{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9f8c66a7_3db24090",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-01-28T12:33:54Z",
      "side": 1,
      "message": "Would it possible and better to have the build number determined here and passed in on the command line, instead of the environment?",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d76044c6_9181cd42",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-01-28T20:28:09Z",
      "side": 1,
      "message": "The build number is determined here already. What do you mean?\n\nIt can\u0027t be a configuration because the environment variable affects the behavior of the repository, where config settings like --//common:use_prebuilt_gki aren\u0027t parsed yet (so its value won\u0027t be known). This corresponds to:\n\nhttps://android-review.googlesource.com/c/kernel/build/+/1949679/8/kleaf/download_repo.bzl#141",
      "parentUuid": "9f8c66a7_3db24090",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8274496_8e47e669",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-01-31T09:51:44Z",
      "side": 1,
      "message": "I think my main point is: Why have we built something where useful configuration can only live in the environment? Is this a fundamental Bazel limitation?\n\nUnix tradition is to support, later overriding earlier:\n\n* code defaults\n* configuration files\n* environment variables\n* command line arguments\n\nAnd I would most happily live without the environment option.\n\nSee also (in no particular order):\n\n* https://stackoverflow.com/questions/32272911/precedence-of-configuration-options-environment-registry-configuration-file-a\n* https://stackoverflow.com/questions/11077223/what-order-of-reading-configuration-values\n* http://www.catb.org/~esr/writings/taoup/html/ch10s06.html and http://www.catb.org/~esr/writings/taoup/html/configurationchapter.html more generally",
      "parentUuid": "d76044c6_9181cd42",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b8af30b6_dfb644ce",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-02-02T07:07:56Z",
      "side": 1,
      "message": "This is exactly what it is doing right now.\n\n- code defaults: bazel.WORKSPACE file.\n\nIn this particular case, there\u0027s no default. But if there were one, it would be specified in bazel.WORKSPACE file as `build_number\u003dxxx`.\n  \nhttps://android-review.googlesource.com/c/kernel/build/+/1949680/15/kleaf/bazel.WORKSPACE\n  \n- configuration files: `device.bazelrc`\n\nThis is a device-specific configuration, so we allow devices to override the value and refer to a specific build number.\n\nThis is CL:1949681.\n  \n- environment variables:\n\nTechnically this may be overridden if the user specifies `KLEAF_DOWNLOAD_BUILD_NUMBER_MAP`, but I consider it an implementation detail and intentionally hide it from the user docs:\n  \nhttps://android-review.googlesource.com/c/kernel/build/+/1947627/19/kleaf/download_repo.bzl#b175\n  \nIt is expected that users use command line arguments instead. This matches what you say:\n\n\u003e And I would most happily live without the environment option.\n  \n- command line arguments: --use_prebuilt_gki\u003dxxx\n\nThe purpose of this CL is to support this.\n  \nInternally, it is implemented by specifying KLEAF_DOWNLOAD_BUILD_NUMBER_MAP environment variable before executing `bazel`. This is a Bazel limitation. When  workspaces are loaded, the user-defined command line arguments (--//common:use_prebuilt_gki in this case) can\u0027t be referred to yet.",
      "parentUuid": "e8274496_8e47e669",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3a347f9_13b95756",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2022-02-02T07:09:56Z",
      "side": 1,
      "message": "* configuration files: `user.bazelrc` and `device.bazelrc`, actually.\n\n`user.bazelrc` is expected to be modified by a particular developer however they want. `device.bazelrc` is expected to be checked into a device kernel source tree and symlinked to the top of repo. See CL:1949681.",
      "parentUuid": "b8af30b6_dfb644ce",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "48d08a2d_bf3d245f",
        "filename": "kleaf/bazel.py",
        "patchSetId": 12
      },
      "lineNbr": 68,
      "author": {
        "id": 1625880
      },
      "writtenOn": "2022-02-03T21:48:31Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "e3a347f9_13b95756",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 68,
        "endChar": 95
      },
      "revId": "afeb9319611ca2f937f0adbda41797616060bbb6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}