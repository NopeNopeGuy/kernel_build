{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "005023f5_7ece0323",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-16T19:42:22Z",
      "side": 1,
      "message": "Also overall comment: I think local mode and offline mode should be separate.\n\nThe `--local` flag refers to that, during init_ddk.py execution, there should not be internet access (usually assuming that there\u0027s already a source tree checkout / prebuilts downloaded).\n\nThe offline mode refers to that during `bazel build` it should not reach out to the internet; i.e. `--config\u003dno_internet`. To do that, we need local_path_override().\n\nThe offline mode may be the default and we probably don\u0027t need a flag for it.",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce0fc22b_d1587ccd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-20T15:36:58Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "005023f5_7ece0323",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a934ef5a_e5e3905a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-20T23:49:09Z",
      "side": 1,
      "message": "Let me rephrase what I mean.\n\nThe `--local` flag is to ensure `init_ddk` don\u0027t write to `kleaf_repo` / `prebuilts_dir`. In case the user already has a checkout, we don\u0027t want to overwrite what they already have.\n\nThe `--no_internet` flag is to ensure we always use `--config\u003dno_internet` during `bazel build` if the build servers are in a contained environment.\n\nFor simplicity, we can make `--no_internet` always true and I don\u0027t think we should add a flag until partners explicitly request so.",
      "parentUuid": "ce0fc22b_d1587ccd",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bcbdc34_13667462",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-16T00:07:33Z",
      "side": 1,
      "message": "note: rules_rust will go away CL:3090287",
      "range": {
        "startLine": 60,
        "startChar": 6,
        "endLine": 60,
        "endChar": 16
      },
      "fixSuggestions": [
        {
          "fixId": "0bac2773_bf0566e1",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 59,
                "startChar": 0,
                "endLine": 63,
                "endChar": 0
              },
              "replacement": ""
            },
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 119,
                "startChar": 0,
                "endLine": 120,
                "endChar": 0
              },
              "replacement": "                if not skip_line and line.strip():\n"
            },
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 154,
                "startChar": 0,
                "endLine": 155,
                "endChar": 0
              },
              "replacement": "                if not section or line.strip():\n"
            },
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 157,
                "startChar": 0,
                "endLine": 158,
                "endChar": 0
              },
              "replacement": ""
            },
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 159,
                "startChar": 0,
                "endLine": 163,
                "endChar": 0
              },
              "replacement": ""
            }
          ]
        }
      ],
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5dd757aa_96750f34",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-20T15:09:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2bcbdc34_13667462",
      "range": {
        "startLine": 60,
        "startChar": 6,
        "endLine": 60,
        "endChar": 16
      },
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de06340b_7f56eb88",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 163,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-16T00:07:33Z",
      "side": 1,
      "message": "I don\u0027t think the root module should have bazel_dep() on anything unless the user actually uses it (e.g. for the integration tests, I use skylib, so I explicitly add it).\n\nWhat does this fix?",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "378e731c_6dfaebf5",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 163,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-16T20:10:59Z",
      "side": 1,
      "message": "I hit an error with `rules_cc` (http://b/338440785#comment3) my module was just a sample one with the minimum to compile. IMO is hard to know what thing the user will need, hence I added all what was available.",
      "parentUuid": "de06340b_7f56eb88",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6c3da0f_55a186a5",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 163,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-17T20:42:54Z",
      "side": 1,
      "message": "The error with rules_cc should be resolved by adding an empty WORKSPACE.bzlmod file. The problem is probably that without a WORKSPACE file, Bazel generates one with non-empty content that defines **legacy** `rules_cc` (not the bzlmod `rules_cc`, which becomes `@@rules_cc~` later), and something depends on it. I think adding an empty WORKSPACE.bzlmod is a better workaround than explicitly defining bazel_dep(rules_cc) albeit still a workaround.",
      "parentUuid": "378e731c_6dfaebf5",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a4d55638_9c6e6e5c",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 163,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-20T15:09:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d6c3da0f_55a186a5",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd0df757_40f38c47",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 185,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-16T19:42:22Z",
      "side": 1,
      "message": "I am referring to here. I think\n\n```\nif self.kleaf_repo:\n    module_bazel_content +\u003d self._get_local_path_overrides()\n```\n\nmight be more correct (without checking the --local flag)",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3153339e_0941c510",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 185,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-20T15:36:58Z",
      "side": 1,
      "message": "`self.kleaf_repo` without `--local` means the destination where we want to place the kleaf_repo downloaded from `--build_id`, The same could apply to `--prebuilts_dir`.",
      "parentUuid": "fd0df757_40f38c47",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e95e555_2e69b007",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 185,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-20T23:49:09Z",
      "side": 1,
      "message": "Whether we are downloading or not downloading --kleaf_repo in init_ddk has nothing to do with whether we are downloading / not downloading external dependencies during `bazel build`. \n\nSo even if we have `--kleaf_repo` without `--local`, `local_path_override()` has nothing to do with this. \n\n```\nif self.ddk_workspace and self.kleaf_repo and self.no_internet:\n   # generate local_path_override()\nif self.ddk_workspace and self.kleaf_repo:\n   # generate WORKSPACE.bzlmod\n```\n\n... but for simplicity, I think we can just have `self.no_internet \u003d\u003d\u003d True` until there\u0027s a need to tweak it. So it simplifies to:\n\n```\nif self.ddk_workspace and self.kleaf_repo:\n   # generate local_path_override()\n   # generate WORKSPACE.bzlmod\n```\n\n(self.ddk_workspace is always set because of L167; I just put it there for illustration purposes)",
      "parentUuid": "3153339e_0941c510",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a747462b_8c778123",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 185,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-21T00:09:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9e95e555_2e69b007",
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07a19e77_f5436020",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 318,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-05-16T19:50:37Z",
      "side": 1,
      "message": "unrelated: could you explain why _handle_prebuilts needs self.ddk_workspace again?\n\nBackground: I am working on extracting the headers and I am planning to use `if self.prebuilts_dir` as the predicate. If there are prebuilts, I\u0027ll extract headers from there.",
      "range": {
        "startLine": 318,
        "startChar": 11,
        "endLine": 318,
        "endChar": 33
      },
      "fixSuggestions": [
        {
          "fixId": "4e926181_53441b8e",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "init/init_ddk.py",
              "range": {
                "startLine": 318,
                "startChar": 0,
                "endLine": 319,
                "endChar": 0
              },
              "replacement": "        if not self.prebuilts_dir:\n"
            }
          ]
        }
      ],
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "94b7750a_da085106",
        "filename": "init/init_ddk.py",
        "patchSetId": 6
      },
      "lineNbr": 318,
      "author": {
        "id": 1961395
      },
      "writtenOn": "2024-05-20T15:36:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "07a19e77_f5436020",
      "range": {
        "startLine": 318,
        "startChar": 11,
        "endLine": 318,
        "endChar": 33
      },
      "revId": "b58c941cc92733864cec62570037592bcaf215cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}