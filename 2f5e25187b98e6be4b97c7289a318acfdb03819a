{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "30d55c44_87410b88",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1402878
      },
      "writtenOn": "2021-10-08T12:49:31Z",
      "side": 1,
      "message": "the downside also extends to the command line. you are not able to build kernel/vmlinux as a target anymore. That is quite severe. I think we need to find another solution here.",
      "revId": "2f5e25187b98e6be4b97c7289a318acfdb03819a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66593aa9_964c9cb4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-08T22:54:21Z",
      "side": 1,
      "message": "https://github.com/bazelbuild/bazel/issues/281\n\nAnother (dirty) solution is to add an `outs_select` attribute, e.g.\n\n```\nkernel_build(\n  name \u003d \"foo\",\n  outs \u003d [\"foo.dtb\"],\n  outs_select \u003d {\n    \"mixed\": [],\n    \"regular\": [\"vmlinux\"],\n  }\n)\n```\n\n... which translates to:\n\n```\n_kernel_build(\n  name \u003d \"foo\",\n  outs \u003d [\"foo/foo.dtb\"] + select({\n    \"mixed\": [],\n    \"regular\": [\"foo/vmlinux\"],\n  }),\n)\n```",
      "parentUuid": "30d55c44_87410b88",
      "revId": "2f5e25187b98e6be4b97c7289a318acfdb03819a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "320311fb_efd93860",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-08T22:56:15Z",
      "side": 1,
      "message": "I was hoping to find some magic to detect the type of `outs`: if it is a list then pass it on. If it is a dict then wrap it into \"select\". But I can\u0027t find a way to check types of an object in Bazel.",
      "parentUuid": "66593aa9_964c9cb4",
      "revId": "2f5e25187b98e6be4b97c7289a318acfdb03819a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d601a8e_607be507",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-08T22:57:32Z",
      "side": 1,
      "message": "nevermind, I could use https://docs.bazel.build/versions/3.4.0/skylark/lib/globals.html#type\n\nSo maybe:\n\n```\nkernel_build(\n  name \u003d \"foo\",\n  outs \u003d {\n    \"mixed\": [\"foo.dtb\"],\n    \"regular\": [\"vmlinux\", \"foo.dtb\"],\n  }\n)\n```\nwhich becomes\n_kernel_build(\n  name \u003d \"foo\",\n  outs \u003d select({\n    \"mixed\": [\"foo/foo.dtb\"],\n    \"regular\": [\"foo/vmlinux\", \"foo/foo.dtb\"],\n  }),\n)\n```\n?",
      "parentUuid": "320311fb_efd93860",
      "revId": "2f5e25187b98e6be4b97c7289a318acfdb03819a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0bb4f299_71147bc4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-10-09T02:26:12Z",
      "side": 1,
      "message": "This doesn\u0027t work because:\n\n```\nattribute \"outs\" is not configurable\n```\n\nattr.output_list() is not configurable, meaning that select() statements cannot be passed to output_list()\u0027s. This is explained in https://github.com/bazelbuild/bazel/issues/281, and the suggestion is to use `declare_file` instead. But `kernel/vmlinux` wouldn\u0027t work in this case.\n\nI could still do:\n\n```\nkernel_build(\n  name \u003d \"foo\",\n  outs \u003d [\"foo.dtb\"],\n  outs_select \u003d {\n    \"mixed\": [],\n    \"regular\": [\"vmlinux\"],\n  }\n)\n```\n\n... but `foo/foo.dtb` would be a valid target, and `foo/vmlinux` is still not a valid target.",
      "parentUuid": "8d601a8e_607be507",
      "revId": "2f5e25187b98e6be4b97c7289a318acfdb03819a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}